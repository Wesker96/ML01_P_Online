#### Тема лекции: SQL

###### Полезные материалы по SQL
 - [Интерактивный учебник по SQL](https://sql-academy.org/ru/guide)
 - [Сказ о функциях в SQL](https://proglib.io/p/funkcii-i-hranimye-procedury-v-sql-zachem-nuzhny-i-kak-primenyat-v-realnyh-primerah-2022-10-07)
 - [Вводная статья о SQLAlchemy](https://skillbox.ru/media/code/sqlalchemy-chto-eto-takoe-i-zachem-nuzhno/)
 - [Статья о триггерах в SQL](https://timeweb.cloud/tutorials/postgresql/postgresql-triggery-sozdanie-udalenie-primery)
 - Что-то по AI, случайно нашел во время урока: [ссылка](https://github.com/youssefHosni/Weekly-Top-Computer-Vision-Papers)

###### Конспект

**Structured Query Language** - язык структурированных запросов, стандартный язык программирования реляционных баз данных. Был разработан в начале 1970-х и стал стандартом ANSI в 1986 году, а в 1987 - ISO.

Существуют несколько диалектов SQL:
1. T-SQL - диалект Microsoft SQL Server
2. PL/SQL - диалект Oracle Database
3. PL/pgSQL - диалект PostgreSQL

Виды баз данных:
- реляционные - данные хранятся в виде таблиц. Примеры: MySQL, PostgreSQL
- нереляционные:
	- документо-ориентированные: данные хранятся в виде документов Пример: MongoDB
	- ключ-значение: данные хранятся в структуре "словарь" Пример: Redis
	- графовые: для хранения графовых структур Пример: Neo4j
	- колоночные: хранят колонки данных. Пример: db4o
- Объектно-ориентированные: сложные структуры, объекты.

Виды SQL запросов:
 - DML - data manipulation language: BULK INSERT, SELECT, DELETE, UPDATE, INSERT, UPDATETEXT, MERGE, WRITETEXT, READTEXT;
 - DDL - data definition language: ALTER, COLLATE, CREATE, DROP, DISABLE TRIGGER, ENABLE TRIGGER, RENAME, UPDATE STATISTIC;
 - DCL - data control language: GRANT, REVOKE, DENY;
 - TCL - transaction control language: BEGIN, COMMIT, ROLLBACK.

```
Краткое описание команд
	SELECT - выборка данных, возвращает таблицу;
	INSERT - вставка данных;
	DELETE - удаление данных;
	TRUNCATE - тоже что и DELETE, но операция производится путем удаления исходной таблицы и создания новой. Эффективно для больших таблиц
	UPDATE - изменяет существующие данные;
	WHERE - фильтрация данных;
	BETWEEN - фильтрация данных по диапазону;
	IN - фильтрация по списку значений
	LIKE - фильтрация по паттерну
	ORDER BY - вывод данных в отсортированном виде
	SELECT DISTINCT - возвращает уникальные значения
	HAVING - действует как WHERE но после группировки данных
	JOIN - объединение таблиц
	LIMIT - ограничение выборки, первое число начало (с какого элемента, отсчет с 0), второе - количество, сдвиг
	WITH - оператор для написания обощенного табличного выражения (CTE) - что есть временный результирующий набор данных
	UNION - объединение результатов запросов (по умолчанию убирает повторения)
	INTERSECT - комбинирует два запроса SELETC, однако возвращает записи только первого запроса которые имеют совпадения во втором запросе
	EXCEPT - комбинирует два запроса SELETC, однако возвращает записи только первого запроса которые не имеют совпадения во втором запросе
	IFNULL - на вход подается два значения, возвращается первое значение, если не равно NULL, иначе - второе
	NULLIF - на вход подается два значения, если они равны, то возвращается NULL, иначе - первое значение
	VALUES - перечисление
	CAST - принудительное преобразование типа данных
	STR_TO_DATE - преобразует строку в тип данных дата, используется в случае, когда дата не соответствует формату
	
```

**Первичный ключ** - основной ключ, удовлетворяющий требованию уникальности и минимальности.


![[media/sql_op_sets.png]]
Рис - Операции над множествами

В SQL есть такой механизм, как подзапросы. Подзапрос всегда заключён в круглые скобки и обычно выполняется перед основным запросом. Пример

```sql
SELECT * FROM Reservations
    WHERE Reservations.room_id = (
        SELECT id FROM Rooms ORDER BY price DESC LIMIT 1
    )
```

**Скалярный подзапрос** - подзапрос возвращающий одну строку и один столбец.
**Коррелированный подзапрос** - подзапрос, который ссылается на один, либо несколько столбцов основного запроса. Стоит иметь ввиду, что такие запросы заметно влияют на производительность.

```
Различие форматов дат DATETIME и TIMESTAMP

Оба формата предназначены для хранения времени, однако имеют некоторые различия. 

DATETIME: диапазон от 1000-01-01 00:00:00 до 9999-12-31 23:59:59
TIMESTAMP: диапазон от 1970-01-01 00:00:00 до 2038-01-19 03:14:07

TIMESTAMP учитывает часовой пояс.

```

сначала нужно подключить коннектор
используем pandas

коннектор подключается к конкретной базе данных

###### Задания во время лекции

```sql
SELECT * FROM <name_table> AS t
```

Написал функцию по заданию:
```sql
select * from german_credit as t where (t.purpose=="car" or t.purpose=="education") and t.sex=="male"
```

Еще один SQL запрос
```sql
select * from credit_train as t where (t.credit_sum > 10000 and t.credit_sum < 20000) and t.living_region like '%ОБЛ%' order by t.credit_sum
```

#### Домашнее задание

```
В рамках ранее выполненной работы по обработке данных, выполнить все работы 
с pandas data-фреймом через SQL запросы.

Данные: credit_train.csv

- разбить выборку на обучающую и тестовую: train_and_split
- проанализировать пропуски и решить, что с ними делать
- проанализировать выбросы
- создать/удалить переменные
- закодировать категориальные переменные
- нормализовать числовые переменные (при необходимости)

random_forest_classificator

```


